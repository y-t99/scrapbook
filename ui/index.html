<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Scrapbook Editor</title>
    <link rel="stylesheet" href="editor.css"/>
    <style>
        body {
            font-family: 'scrapbook_editor';
            font-size: 14px;
        }
    </style>
</head>

<body style="padding: 100px">

<h1>Scrapbook</h1>

<form action="">

    <div id="scrapbook_page"></div>

</form>

</body>
</html>

<script src="lib/checklist.umd.js"></script>
<script src="lib/editorjs.umd.js"></script>
<script>

    const tauri = window.__TAURI__;

    const transformEventModel = async (api, e) => {
        let savedData = {data: {}};
        if (e.type !== 'block-removed') {
            const block = api.blocks.getById(e.detail.target.id);
            savedData = await block.save();
        }
        return {
            action_type: e.type,
            index: e.detail.index,
            fromIndex: e.detail.fromIndex,
            toIndex: e.detail.toIndex,
            block: {
                id: savedData.id,
                tool: savedData.tool,
                data: savedData && savedData.data
            }
        }
    };

    const editor = new EditorJS({
        holder: 'scrapbook_page',

        tools: {
            checklist: {
                class: Checklist,
                inlineToolbar: true
            }
        },

        onChange: async (api, event) => {
            if (typeof tauri !== "undefined") {
                const invoke = tauri.invoke;
                const events = [];
                if (Array.isArray(event)) {
                    for (let i = 0; i < event.length; i++) {
                        events.push(await transformEventModel(api, event[i]));
                    }
                } else {
                    events.push(await transformEventModel(api, event));
                }
                invoke('document_change', {events: events});
            }
        },

        data: {
            blocks: [
                {
                    id: "al57AJRbHN",
                    type: "paragraph",
                    data: { text: "HELLO SCRAPBOOK!" }
                }
            ]
        }
    });

</script>