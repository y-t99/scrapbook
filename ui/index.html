<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Scrapbook Editor</title>
    <link rel="stylesheet" href="editor.css"/>
    <style>
        body {
            font-family: 'scrapbook_editor';
            font-size: 14px;
        }
    </style>
</head>

<body style="padding: 100px">

<h1>Scrapbook</h1>

<form action="">

    <div id="scrapbook_page"></div>

</form>

</body>
</html>

<script src="lib/checklist.umd.js"></script>
<script src="lib/editorjs.umd.js"></script>
<script>

    var editor = new EditorJS({
        holder: 'scrapbook_page',

        tools: {
            checklist: {
                class: Checklist,
                inlineToolbar: true
            }
        },

        onChange: async (api, event) => {
            const tauri = window.__TAURI__;
            const transformEventModel = async (e) => {
                const block = api.blocks.getById(e.detail.target.id);
                const savedData = await block.save();
                return {
                    type: e.type,
                    block: {
                        id: e.detail.target.id,
                        type: e.detail.target.name,
                        data: savedData && savedData.data,
                    }
                }
            };
            if (typeof tauri !== "undefined") {
                const invoke = tauri.invoke;
                const events = [];
                if (Array.isArray(event)) {
                    for (let i = 0; i < event.length; i++) {
                        events.push(await transformEventModel(event[i]));
                    }
                } else {
                    events.push(await transformEventModel(event));
                }
                invoke('document_change', {events: events});
            }
        }
    });


</script>