<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Scrapbook Editor</title>
    <link rel="stylesheet" href="editor.css"/>
    <style>
        body {
            font-family: 'scrapbook_editor';
            font-size: 14px;
        }
    </style>
</head>

<body style="padding: 100px">

<h1>Scrapbook</h1>

<form action="">

    <div id="scrapbook_page"></div>

</form>

</body>
</html>

<script src="lib/checklist.umd.js"></script>
<script src="lib/editorjs.umd.js"></script>
<script>

    var editor = new EditorJS({
        holder: 'scrapbook_page',

        tools: {
            checklist: {
                class: Checklist,
                inlineToolbar: true
            }
        },

        onChange: async (api, event) => {
            console.log(api);
            const tauri = window.__TAURI__;
            if (typeof tauri !== "undefined") {
                const invoke = tauri.invoke;
                const events = [];
                if (Array.isArray(event)) {
                    for (let i = 0; i < event.length; i++) {
                        const block = api.blocks.getById(event[i].detail.target.id);
                        const savedData = await block.save();
                        events.push({
                            type: event[i].type,
                            block: {
                                id: event[i].detail.target.id,
                                type: event[i].detail.target.name,
                                data: savedData && savedData.data,
                            }
                        });
                    }
                } else {
                    const block = api.blocks.getById(event.detail.target.id);
                    const savedData = await block.save();
                    console.log(savedData);
                    events.push({
                        type: event.type,
                        block: {
                            id: event.detail.target.id,
                            type: event.detail.target.name,
                            data: savedData && savedData.data,
                        }
                    });
                }
                invoke('document_change', {
                    event: JSON.stringify(events, null, 2)
                });
            }
        }
    });


</script>